
<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ØªØ³Ø¨ÙŠØ­ â€” Ø´Ø§Ø±Ùƒ Ø§Ù„Ø£Ø¬Ø±</title>
<meta name="theme-color" content="#0b1514"/>
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&display=swap" rel="stylesheet">
<style>
  :root{
    --bg:#0b1514;--bg2:#0f1f1d;--card:#0f2321;--edge:#1a3733;
    --text:#eef8f6;--muted:#a8c9c2;--btn1:#19c77a;--btn2:#0da261;
    --accent1:#27e3a1;--accent2:#0fa563;--ring:#173a35;
    --shadow:0 24px 60px rgba(0,0,0,.45);
  }
  *{box-sizing:border-box;-webkit-tap-highlight-color:transparent}
  body{
    margin:0;min-height:100dvh;display:grid;place-items:center;
    background:
      radial-gradient(1000px 600px at 0% -10%, #154d45 0, transparent 60%),
      radial-gradient(1200px 600px at 110% 0%, #0a3b35 0, transparent 60%),
      linear-gradient(180deg,var(--bg),var(--bg2));
    color:var(--text);font-family:"Cairo",system-ui,-apple-system,"Segoe UI",Arial;
    overflow-x:hidden;
  }
  .wrap{width:min(96vw,880px);padding:22px}
  .card{
    background:linear-gradient(180deg,#0f2422,var(--card));
    border:1px solid var(--edge);border-radius:26px;padding:26px;text-align:center;
    box-shadow:var(--shadow);
  }

  /* Ø§Ù†ØªÙ‚Ø§Ù„Ø§Øª ØµÙØ­Ø§Øª */
  .screen{display:none; opacity:0; transform:translateY(14px); transition:opacity .45s ease, transform .45s ease}
  .screen.show{display:block; opacity:1; transform:translateY(0)}

  /* Ø´Ø¹Ø§Ø± Ù…Ø³Ø¬Ø¯ */
  .logo{
    width:78px;height:78px;margin:0 auto 12px;border-radius:18px;
    display:grid;place-items:center;
    background:linear-gradient(145deg,var(--accent1),var(--accent2));
    box-shadow:0 10px 26px rgba(31,214,128,.25), inset 0 1px 0 rgba(255,255,255,.12);
    transform:translateY(8px); animation:bounce-in .6s .05s forwards ease-out; opacity:0;
  }
  .logo svg{width:46px;height:46px;fill:#073d35;opacity:.95}
  @keyframes bounce-in{to{opacity:1; transform:translateY(0)}}

  h1{margin:6px 0 10px;font-weight:900;font-size:clamp(1.1rem,3vw,1.6rem)}
  .muted{color:var(--muted)}

  /* Ø²Ø± Ø«Ù„Ø§Ø«ÙŠ Ø§Ù„Ø£Ø¨Ø¹Ø§Ø¯ */
  .btn{
    display:inline-grid;place-items:center;gap:6px;grid-auto-flow:column;
    padding:12px 22px;border-radius:14px;border:none;cursor:pointer;
    color:#fff;background:linear-gradient(145deg,var(--btn1),var(--btn2));
    font-weight:900;
    box-shadow:
      0 16px 32px rgba(31,214,128,.25),
      inset 0 1px 0 rgba(255,255,255,.18),
      inset 0 -6px 14px rgba(0,0,0,.25);
    transform:translateY(0); transition:transform .15s ease, filter .2s ease;
  }
  .btn:hover{filter:brightness(1.03)}
  .btn:active{transform:translateY(2px)}

  /* Ù†Øµ Ø§Ù„Ø°ÙƒØ± */
  #dhikrText{
    margin:12px auto 16px;line-height:1.9;text-align:center;
    font-size:0;opacity:0;transform:translateY(-6px);
    transition:opacity .25s, transform .25s, font-size .25s;min-height:3.2em;
  }
  #dhikrText.showTxt{font-size:clamp(1rem,3.2vw,1.28rem);opacity:1;transform:translateY(0)}
  #dhikrText.shake{animation:shake .28s ease}
  @keyframes shake{0%,100%{transform:translateX(0)}25%{transform:translateX(3px)}50%{transform:translateX(-3px)}75%{transform:translateX(2px)}}

  /* Ø§Ù„Ø­Ù„Ù‚Ø© */
  canvas{width:min(78vw,360px);height:min(78vw,360px);max-width:360px;max-height:360px}
  .ringWrap{display:grid;place-items:center;margin:14px auto}
  .tapHint{margin-top:8px;color:var(--muted)}

  /* Ø§Ù„Ù†Ù‡Ø§ÙŠØ© */
  .bigShare{
    margin:16px auto 12px;width:min(78vw,286px);height:min(78vw,286px);border-radius:50%;border:none;
    display:grid;place-items:center;background:linear-gradient(145deg,var(--btn1),var(--btn2));
    color:#fff;font-weight:900;cursor:pointer;
    box-shadow:
      12px 12px 22px rgba(10,59,39,.75),
      -12px -12px 22px rgba(31,214,128,.18),
      inset 8px 8px 16px rgba(0,0,0,.35),
      inset -8px -8px 16px rgba(255,255,255,.07);
    transition:transform .15s ease, filter .2s ease;
  }
  .bigShare:hover{filter:brightness(1.03)}
  .bigShare:active{transform:scale(.99)}
  .visits{margin:8px 0 16px;color:var(--muted)}
  .ads{width:100%;display:grid;place-items:center;margin-top:12px}
  .ad-box{
    width:300px;height:250px;background:rgba(255,255,255,.06);
    border:1px dashed #2f5e57;border-radius:12px;display:grid;place-items:center;
    color:#bfe6de;font-weight:700
  }
  .confetti{position:fixed;inset:0;pointer-events:none;overflow:hidden;z-index:9999}
  .paper{position:absolute;width:8px;height:14px;border-radius:2px;opacity:.9;animation:fall 3.4s linear forwards}
  @keyframes fall{0%{transform:translateY(-10vh) rotate(0)}100%{transform:translateY(110vh) rotate(780deg)}}
</style>
</head>
<body>

<!-- Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© -->
<main class="wrap screen show" id="start">
  <section class="card">
    <div class="logo" aria-hidden="true">
      <!-- Ù…Ø³Ø¬Ø¯ SVG -->
      <svg viewBox="0 0 64 64"><path d="M32 6l6 6v6h6v8h6v26H14V26h6v-8h6V12l6-6z"/></svg>
    </div>
    <h1>ï·½</h1>
    <p class="muted">ï´¿ Ø³ÙØ¨Ù‘ÙÙ‘Ø­Ù Ø§Ø³Ù’Ù…Ù Ø±ÙØ¨Ù‘ÙÙƒÙ Ø§Ù„Ø£ÙØ¹Ù’Ù„ÙÙ‰ ï´¾</p>
    <button class="btn" id="go" type="button">Ø§Ø¨Ø¯Ø£ Ø§Ù„ØªØ³Ø¨ÙŠØ­</button>
  </section>
</main>

<!-- Ø§Ù„ØªØ³Ø¨ÙŠØ­ -->
<main class="wrap screen" id="app">
  <section class="card">
    <div class="logo" aria-hidden="true">
      <svg viewBox="0 0 64 64"><path d="M32 6l6 6v6h6v8h6v26H14V26h6v-8h6V12l6-6z"/></svg>
    </div>
    <h1>ØªØ³Ø¨ÙŠØ­ ÙˆØ°ÙƒØ± Ø§Ù„Ù„Ù‡</h1>
    <p class="muted">Ø§Ø¶ØºØ· Ø§Ù„Ø­Ù„Ù‚Ø© 10 Ù…Ø±Ø§ØªØŒ Ø«Ù… ØªÙÙØªØ­ ØµÙØ­Ø© Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ©</p>

    <div id="dhikrText">Ø³Ø¨Ø­Ø§Ù† Ø§Ù„Ù„Ù‡ ÙˆØ§Ù„Ø­Ù…Ø¯ Ù„Ù„Ù‡ ÙˆÙ„Ø§ Ø¥Ù„Ù‡ Ø¥Ù„Ø§ Ø§Ù„Ù„Ù‡ ÙˆØ§Ù„Ù„Ù‡ Ø£ÙƒØ¨Ø±</div>

    <div class="ringWrap">
      <canvas id="ring" width="360" height="360" aria-label="Ø­Ù„Ù‚Ø© Ø§Ù„ØªØ³Ø¨ÙŠØ­"></canvas>
      <div class="tapHint">Ø§Ø¶ØºØ· Ø¯Ø§Ø®Ù„ Ø§Ù„Ø­Ù„Ù‚Ø©</div>
    </div>

    <div class="muted">
      Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ: <b id="left">10</b> / 10 â€” Ø§Ù„Ø¹Ø¯Ù‘Ø§Ø¯: <b id="count">0</b>
    </div>

    <button class="btn" id="backStart" type="button" style="margin-top:10px">â†© Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„ØµÙØ­Ø© Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©</button>
  </section>
</main>

<!-- Ø§Ù„Ù†Ù‡Ø§ÙŠØ© -->
<main class="wrap screen" id="end">
  <section class="card">
    <div class="logo" aria-hidden="true">
      <svg viewBox="0 0 64 64"><path d="M32 6l6 6v6h6v8h6v26H14V26h6v-8h6V12l6-6z"/></svg>
    </div>
    <h1>Ø¬Ø²Ø§Ùƒ Ø§Ù„Ù„Ù‡ Ø®ÙŠØ±Ù‹Ø§</h1>
    <p class="visits">Ø²Ø§Ø¦Ø±ÙˆØ§ Ø§Ù„ØµÙØ­Ø©: <b id="visitors">â€”</b></p>

    <button id="shareBtn" class="bigShare" type="button">ğŸ“¤ Ø´Ø§Ø±Ùƒ Ø§Ù„Ø£Ø¬Ø± Ø¹Ù„Ù‰ ÙˆØ§ØªØ³Ø§Ø¨</button>

    <div class="ads">
      <div class="ad-box" id="ad-space">Ù…Ø³Ø§Ø­Ø© Ø¥Ø¹Ù„Ø§Ù†ÙŠØ© 300Ã—250</div>
    </div>

    <div style="margin-top:16px;font-size:16px;color:#cfe7e2">
      ğŸ“© Ù„Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª ÙˆØ§Ù„ØªÙˆØ§ØµÙ„:
      <a href="mailto:abd30.3000@gmail.com" style="color:#7fd1ff;text-decoration:none">abd30.3000@gmail.com</a>
    </div>

    <button class="btn" id="backStart2" type="button" style="margin-top:10px">â†© Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„ØµÙØ­Ø© Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©</button>
  </section>
</main>

<div id="confetti" class="confetti"></div>

<script>
(() => {
  "use strict";
  const SHARE_URL = "https://share.google/y1S9s1xfewux5ikaA";
  const COUNT_NAMESPACE = "tasbih-enhanced-v1";
  const COUNT_KEY = "visitors";
  const DHIKR = "Ø³Ø¨Ø­Ø§Ù† Ø§Ù„Ù„Ù‡ ÙˆØ§Ù„Ø­Ù…Ø¯ Ù„Ù„Ù‡ ÙˆÙ„Ø§ Ø¥Ù„Ù‡ Ø¥Ù„Ø§ Ø§Ù„Ù„Ù‡ ÙˆØ§Ù„Ù„Ù‡ Ø£ÙƒØ¨Ø±";

  const start = document.getElementById("start");
  const app   = document.getElementById("app");
  const end   = document.getElementById("end");
  const go = document.getElementById("go");
  const backStart = document.getElementById("backStart");
  const backStart2 = document.getElementById("backStart2");

  function show(which){
    [start,app,end].forEach(s=>s.classList.remove("show"));
    (which==="start"?start:which==="app"?app:end).classList.add("show");
    // Scroll to top after transition for mobile
    setTimeout(()=>{ try{window.scrollTo({top:0,behavior:"smooth"})}catch{} }, 60);
  }
  go.addEventListener("click", ()=> show("app"));
  backStart.addEventListener("click", ()=> show("start"));
  backStart2.addEventListener("click", ()=> show("start"));

  const dhikrEl=document.getElementById("dhikrText"),
        leftEl =document.getElementById("left"),
        countEl=document.getElementById("count"),
        cv=document.getElementById("ring"),
        ctx=cv.getContext("2d");

  const DPR=Math.max(1,window.devicePixelRatio||1), SIZE=360;
  cv.width=SIZE*DPR; cv.height=SIZE*DPR;

  let N=10, left=N, count=0;

  function draw(progress){
    const w=cv.width, h=cv.height, r=Math.min(w,h)/2 - 22*DPR;
    ctx.clearRect(0,0,w,h);
    ctx.save(); ctx.translate(w/2,h/2);

    ctx.lineWidth = 16*DPR; ctx.strokeStyle = "#173a35";
    ctx.beginPath(); ctx.arc(0,0,r,0,Math.PI*2); ctx.stroke();

    const ang = progress * Math.PI*2;
    const gr = ctx.createLinearGradient(-r,0,r,0);
    gr.addColorStop(0,"#27e3a1"); gr.addColorStop(1,"#0fa563");
    ctx.strokeStyle=gr; ctx.lineCap="round";
    ctx.beginPath(); ctx.arc(0,0,r,-Math.PI/2, -Math.PI/2 + ang); ctx.stroke();

    ctx.fillStyle="#eef8f6"; ctx.font=(18*DPR)+"px Cairo, system-ui";
    ctx.textAlign="center"; ctx.fillText("Ø§Ø¶ØºØ· Ù‡Ù†Ø§", 0, 8*DPR);

    ctx.restore();
  }

  function beep(){
    try{
      if(!window._ac) window._ac = new (window.AudioContext||window.webkitAudioContext)();
      const ac=window._ac, o=ac.createOscillator(), g=ac.createGain();
      o.type='sine'; o.frequency.value=720; g.gain.value=.06;
      o.connect(g).connect(ac.destination);
      const t=ac.currentTime; o.start(t);
      g.gain.exponentialRampToValueAtTime(0.0001,t+.09); o.stop(t+.11);
    }catch{}
  }

  function showDhikr(){
    dhikrEl.textContent = DHIKR;
    dhikrEl.classList.remove("showTxt","shake"); void dhikrEl.offsetWidth;
    dhikrEl.classList.add("showTxt","shake");
  }

  cv.addEventListener("click", ()=>{
    if(left<=0) return;
    if(navigator.vibrate) navigator.vibrate(15);
    beep();
    count++; left--;
    leftEl.textContent = left;
    countEl.textContent = count;
    showDhikr();
    draw((N-left)/N);
    if(left===0) showEnd();
  });

  draw(0);

  const shareBtn = document.getElementById("shareBtn");
  const visitorsEl = document.getElementById("visitors");
  const confettiLayer = document.getElementById("confetti");

  shareBtn.addEventListener("click", ()=>{
    window.open("https://wa.me/?text=" + encodeURIComponent(SHARE_URL), "_blank", "noopener");
  });

  async function showEnd(){
    show("end");
    runConfetti(200, 3600);
    try{
      const r = await fetch(`https://api.countapi.xyz/hit/${COUNT_NAMESPACE}/${COUNT_KEY}`, {cache:"no-store"});
      const d = await r.json();
      if (typeof d.value === "number") {
        visitorsEl.textContent = d.value.toLocaleString("ar-EG");
      } else { throw 0; }
    }catch{
      const k="local-visitors-fallback";
      const v=(parseInt(localStorage.getItem(k)||"0",10)+1);
      localStorage.setItem(k,String(v));
      visitorsEl.textContent = v.toLocaleString("ar-EG");
    }
  }

  function runConfetti(amount=140, duration=3200){
    confettiLayer.innerHTML = "";
    confettiLayer.style.display = "block";
    const colors = ["#fff176","#ffd54f","#ff8a65","#4dd0e1","#aed581","#ba68c8","#f06292","#fff"];
    const W = innerWidth, H = innerHeight;
    for(let i=0;i<amount;i++){
      const p = document.createElement("div");
      p.className = "paper";
      p.style.left = (Math.random()*W) + "px";
      p.style.top  = (-20 - Math.random()*H*0.3) + "px";
      p.style.background = colors[(Math.random()*colors.length)|0];
      p.style.animationDelay = (Math.random()*0.8) + "s";
      p.style.transform = `translateY(-10vh) rotate(${Math.random()*360}deg)`;
      confettiLayer.appendChild(p);
    }
    setTimeout(()=>{ confettiLayer.style.display='none'; confettiLayer.innerHTML=""; }, duration);
  }
})();
</script>
</body>
</html>
